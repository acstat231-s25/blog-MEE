---
title: "blog_content_draft"
format: html
editor: 
  markdown: 
    wrap: 72
---

```{r}
#| label: setup
#| include: false

# =================================================================
# Setup: Global Options and Libraries
# =================================================================

# Set code chunk defaults for cleaner output
knitr::opts_chunk$set(
  tidy = FALSE,                # Preserve code formatting
  size = "small",              # Use slightly smaller font for code
  message = FALSE,             # Suppress messages in output
  options(scipen = 1,          # Prefer standard numeric formatting (no scientific notation)
          knitr.kable.NA = '') # Display empty cells instead of "NA" in tables
)

# Load required libraries
library(tidytext)
library(dplyr)
library(widyr)
library(igraph)
library(ggraph)
library(tibble)
library(readr)
library(lubridate)  
library(ggridges)
library(gganimate)
library(magick)

# Load cleaned datasets
nyt <- read_csv("../data/wrangled/nyt_news_data_wrangled.csv")
fox <- read_csv("../data/wrangled/fox_news_data_wrangled.csv")
## guttmacher <- read_csv("../data/Guttmatcher_institute_data/guttmacher_file.csv")  
```

```{r}
#| label: top-words-check
#| include: false

# Tokenize text into individual words
tokens <- bind_rows(
  nyt |> mutate(outlet = "NYT"),
  fox |> mutate(outlet = "Fox")
) |>
  unnest_tokens(word, text) |>
  anti_join(stop_words)  # Remove standard English stop words first

# Additional stop words
custom_stopwords <- tibble(word = c(
  "said", "ms", "mr", "mrs",
  "fox", "news", "nyt", "new", "york", "times",
  "u.s", "one", "two", "also", "would", "including", "don‚Äôt", "that‚Äôs", "it‚Äôs", "wrote", "told",
  "roe"
))
```

```{r}
#| label: clean-tokens
#| include: false

# Tokenize and remove both standard and custom stop words
tokens2 <- bind_rows(
  nyt |> mutate(outlet = "NYT"),
  fox |> mutate(outlet = "Fox")
) |>
  unnest_tokens(word, text) |>
  anti_join(stop_words) |>         # Remove standard English stop words
  anti_join(custom_stopwords)      # Remove custom filler/irrelevant words
```

Long a topic of debate across law, medicine, gender, and religion,
abortion has remained one of the most polarizing issues in American
public life. That polarization deepened in June 2022, when the Supreme
Court‚Äôs decision in Dobbs v. Jackson Women‚Äôs Health Organization
overturned Roe v. Wade, the 1973 ruling that had established a
constitutional right to abortion.The decision unsettled not only the
legal framework around abortion, but also the way the issue is discussed
across the country. As states move in sharply different directions,
media coverage has had to grapple with new divisions, new language, and
new stakes.

At its core, the public debate still turns on a simple but deeply
charged question: is abortion good or bad? How that question gets
answered‚Äìor even framed‚Äìdepends heavily on where one looks. News
coverage of abortion varies sharply by ideological leaning. Conservative
media outlets often emphasize religious and legal arguments by focusing
on fetal personhood, state-level bans, and moral appeals (Williams,
2024). In contrast, liberal media frequently frame abortion in terms of
bodily autonomy, healthcare access, and gender justice, while
emphasizing the disproportionate impact of abortion restrictions on
marginalized communities (Human Rights Watch, 2023). These competing
narratives do more than reflect existing viewpoints but actively shape
public perception of abortion legislation.

In this blog, we examine how abortion is framed by two ideologically
distinct media outlets: Fox News and The New York Times. To trace how
these narratives evolved, we analyzed abortion-related news coverage
from both sources before and after the Dobbs decision. These platforms
were chosen not only for their national prominence and broad audiences,
but also for their well-documented political leanings‚ÄìFox News is widely
recognized as a conservative outlet, while The New York Times is
identified as liberal-leaning (Pew Research Center, 2014; Mitchell et
al., 2020). By comparing these two sources, we aim to better understand
how media framing reflects and reinforces broader ideological divides
around abortion. Using text and sentiment analysis, topic modeling, and
geographic data from the Guttmacher Institute, we explore how media
narratives align with state-level abortion laws and how discourse
evolves in response to shifting legal landscapes.

## Volume of Coverage Over Time

We collected a total of `3,168` abortion-related news articles. `1,739`
were from Fox News and the remaining 1,429 were from The New York Times
between early 2020 and late 2024. The chart below traces the cumulative
number of articles over time to show how coverage evolved across both
outlets.

```{r}
#| label: plot-timeline
#| echo: false

# Ensure pub_date is in Date format
nyt <- nyt |> mutate(pub_date = as.Date(pub_date))
fox <- fox |> mutate(pub_date = as.Date(pub_date))

# Combine datasets with outlet labels
nyt_time <- nyt |> mutate(outlet = "NYT")
fox_time <- fox |> mutate(outlet = "Fox")
all_time <- bind_rows(nyt_time, fox_time)

# Plotting the timeline

all_time |>
  filter(!is.na(pub_date)) |> 
  count(pub_date, outlet) |>
  group_by(outlet) |>
  arrange(pub_date) |>
  mutate(cumulative_articles = cumsum(n)) |> 
  ggplot(aes(x = pub_date, y = cumulative_articles, fill = outlet)) +
  geom_area(alpha = 0.8, color = "white", size = 0.2) +  # Stacked areas
  geom_vline(xintercept = as.Date("2022-06-24"), 
             linetype = "dashed", color = "gray50", size = 0.8) +
  annotate("text", x = as.Date("2022-06-24") + 30, y = Inf, 
           label = "Dobbs Decision\n(June 24, 2022)", 
           vjust = 1.5, hjust = 0, size = 3.5, color = "gray50", fontface = "italic") +
  scale_fill_manual(values = c("NYT" = "#263995", "Fox" = "#d81f25")) +
  scale_x_date(date_breaks = "6 months", date_labels = "%b %Y") +
  scale_y_continuous(labels = scales::comma) +
  labs(
    title = "Cumulative Coverage of Abortion-Related Articles (Stacked Area Chart)",
    subtitle = "Tracking cumulative reporting over time | Dobbs Decision and 2024 Election marked",
    x = NULL,
    y = "Cumulative Number of Articles",
    fill = NULL
  ) 

```

## Sentiment and Language Shift in Abortion Coverage Before and After Dobbs

```{r}
#| label: AFINN

# Tokenize and join AFINN
afinn_sentiment <- all_time |> 
  mutate(article_id = row_number()) |>   # Create article_id if missing
  unnest_tokens(word, text_clean) |> 
  inner_join(get_sentiments("afinn"), by = "word")

# Summarize average sentiment score per article
article_sentiment <- afinn_sentiment |> 
  group_by(article_id, pub_date, outlet) |> 
  summarize(mean_sentiment = mean(value), .groups = "drop") |> 
  mutate(dobbs_status = if_else(pub_date < as.Date("2022-06-24"), "Pre-Dobbs", "Post-Dobbs"))

```

```{r}
#| label: animated-line-graph

# Group and smooth
sentiment_trend <- article_sentiment |> 
  mutate(month = floor_date(pub_date, "month")) |> 
  group_by(month, outlet) |> 
  summarize(avg_sentiment = mean(mean_sentiment, na.rm = TRUE), .groups = "drop")

# Plot
p <- ggplot(sentiment_trend, aes(x = month, y = avg_sentiment, color = outlet)) +
  geom_line(size = 1.5) +
  geom_point(size = 2) +
  geom_vline(xintercept = as.Date("2022-06-24"), linetype = "dashed", color = "gray30", size = 0.8) +
  scale_color_manual(values = c("Fox" = "#D81B60", "NYT" = "#1E88E5")) +
  scale_y_continuous(limits = c(-2, 2)) +
  scale_x_date(date_breaks = "6 months", date_labels = "%b %Y") +
  theme_minimal(base_size = 13) +
  labs(
    title = "Sentiment Evolution in Abortion Coverage Over Time",
    subtitle = 'Month: {frame_along}',
    x = "Publication Month",
    y = "Average Sentiment Score (AFINN Scale)",
    color = "Outlet"
  ) +
  theme(legend.position = "bottom") +
  transition_reveal(along = month)

# Animate
animate(p, fps = 10, width = 900, height = 550, renderer = magick_renderer())

# Save
anim_save("sentiment_trend_animation.gif")
```

```{r}
library(ggplot2)
library(dplyr)
library(lubridate)

# Prepare data
sentiment_meter <- article_sentiment |> 
  mutate(month = floor_date(pub_date, "month")) |> 
  group_by(month, outlet) |> 
  summarize(avg_sentiment = mean(mean_sentiment, na.rm = TRUE), .groups = "drop")

# Plot
ggplot(sentiment_meter, aes(x = month, y = avg_sentiment, color = avg_sentiment)) +
  geom_point(size = 5) +
  geom_line(size = 1) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "gray50") +
  scale_color_gradient2(
    low = "red", mid = "yellow", high = "green", midpoint = 0
  ) +
  scale_y_continuous(limits = c(-2, 2), breaks = c(-2, -1, 0, 1, 2)) +
  scale_x_date(date_breaks = "3 months", date_labels = "%b %Y") +
  theme_minimal(base_size = 14) +
  labs(
    title = "Sentiment Evolution Over Time",
    subtitle = "Color indicates emotional tone (Red = negative, Green = positive)",
    x = "Publication Month",
    y = "Mean Sentiment Score"
  ) +
  theme(legend.position = "none")

annotate("text", x = as.Date("2020-01-01"), y = -2, label = "üò¢", size = 8) +
annotate("text", x = as.Date("2020-01-01"), y = 0, label = "üòê", size = 8) +
annotate("text", x = as.Date("2020-01-01"), y = 2, label = "üòÑ", size = 8)

```

```{r}
library(gganimate)
library(ggplot2)
library(dplyr)
library(lubridate)

# Prepare the data
sentiment_pointer <- article_sentiment |> 
  mutate(month = floor_date(pub_date, "month")) |> 
  group_by(month) |> 
  summarize(avg_sentiment = mean(mean_sentiment, na.rm = TRUE), .groups = "drop")

# Set up the base background
p <- ggplot() +
  # Draw the sentiment bar (red-yellow-green)
  geom_rect(aes(xmin = -2, xmax = -1, ymin = 0.4, ymax = 0.6), fill = "red") +
  geom_rect(aes(xmin = -1, xmax = 0, ymin = 0.4, ymax = 0.6), fill = "yellow") +
  geom_rect(aes(xmin = 0, xmax = 2, ymin = 0.4, ymax = 0.6), fill = "green") +
  
  # Add emojis at fixed positions
  annotate("text", x = -2, y = 0.2, label = "üò¢", size = 8) +
  annotate("text", x = -1, y = 0.2, label = "üòü", size = 8) +
  annotate("text", x = 0,  y = 0.2, label = "üòê", size = 8) +
  annotate("text", x = 1,  y = 0.2, label = "üôÇ", size = 8) +
  annotate("text", x = 2,  y = 0.2, label = "üòÉ", size = 8) +
  
  # Add the moving pointer
  geom_point(data = sentiment_pointer, aes(x = avg_sentiment, y = 0.7), 
             shape = 25, size = 8, fill = "black", color = "black") +
  
  # Styling
  scale_x_continuous(limits = c(-2, 2)) +
  scale_y_continuous(limits = c(0, 1)) +
  theme_void() +
  labs(
    title = "Sentiment Meter Over Time",
    subtitle = "Month: {frame_along}"
  ) +
  theme(
    plot.title = element_text(size = 18, face = "bold", hjust = 0.5),
    plot.subtitle = element_text(size = 14, hjust = 0.5)
  ) +
  transition_reveal(along = month)

# Animate it
animate(p, fps = 10, width = 700, height = 400, renderer = magick_renderer())

# Save
anim_save("sentiment_meter_pointer.gif")

```
